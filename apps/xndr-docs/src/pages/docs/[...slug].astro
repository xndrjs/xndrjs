---
import DocLayout from '../../layouts/DocLayout.astro';
import Breadcrumbs from '../../components/Breadcrumbs.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const docs = await getCollection('docs');
  return docs.map((doc) => ({
    params: { slug: doc.id.replace(/\.md$/, '') },
    props: { doc },
  }));
}

interface Props {
  doc: Awaited<ReturnType<typeof getCollection>>[number];
}

const { doc } = Astro.props;
const { Content: DocContent } = await doc.render();

// Remove arrows and path prefixes from titles
const cleanTitle = (title: string): string => {
  const parts = title.split('â†’');
  return parts.length > 1 ? parts[parts.length - 1].trim() : title.trim();
};

// Generate breadcrumbs from doc path
const pathParts = doc.id.replace(/\.md$/, '').split('/');
const breadcrumbItems = [
  { label: 'Home', href: '/' },
  { label: 'Docs', href: '/docs/getting-started/introduction' },
];

if (pathParts.length > 1) {
  const category = pathParts[0];
  const categoryLabel = category.charAt(0).toUpperCase() + category.slice(1).replace(/-/g, ' ');
  breadcrumbItems.push({ label: categoryLabel, href: `/docs/${category}` });
  
  if (pathParts.length > 2) {
    const subcategory = pathParts[1];
    const subcategoryLabel = subcategory.charAt(0).toUpperCase() + subcategory.slice(1).replace(/-/g, ' ');
    breadcrumbItems.push({ label: subcategoryLabel, href: `/docs/${category}/${subcategory}` });
  }
}

breadcrumbItems.push({ label: cleanTitle(doc.data.title), href: Astro.url.pathname });
---

<DocLayout title={doc.data.title} description={doc.data.description || `Documentation for ${doc.data.title}`}>
  <Breadcrumbs items={breadcrumbItems} />
  <DocContent />
</DocLayout>

